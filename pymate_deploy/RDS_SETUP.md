# AWS RDS 생성 및 설정 가이드 (PostgreSQL)

> **대상**: AWS RDS(PostgreSQL) 데이터베이스 생성 및 EC2/로컬 연동 가이드  
> **엔진**: PostgreSQL 16.x (버전은 최신 안정 버전 권장)  
> **인스턴스 타입**: db.t3.micro (프리티어)

## 📋 목차

1. [RDS 인스턴스 생성](#rds-인스턴스-생성)
2. [보안 그룹 설정 (중요)](#보안-그룹-설정-중요)
3. [로컬에서 접속 테스트](#로컬에서-접속-테스트)
4. [Django 프로젝트 연결](#django-프로젝트-연결)
5. [트러블슈팅](#트러블슈팅)

---

## RDS 인스턴스 생성

### Step 1: 대시보드 접속

1. [AWS 콘솔](https://console.aws.amazon.com/)에 접속합니다.
2. 검색창에 **"RDS"**를 입력하고 선택합니다.
3. 왼쪽 메뉴에서 **"데이터베이스"**를 클릭합니다.
4. 우측 상단 주황색 **"데이터베이스 생성"** 버튼을 클릭합니다.

### Step 2: 엔진 옵션

- **데이터베이스 생성 방식**: `표준 생성`
- **엔진 유형**: `PostgreSQL`
- **엔진 버전**: `PostgreSQL 16.x-R2` (기본값 또는 최신 버전 선택)
- **템플릿**: `프리 티어` (*반드시 선택!*)

### Step 3: 설정

#### 1️⃣ DB 인스턴스 식별자
- **DB 인스턴스 식별자**: `skn21-django-db` (원하는 이름)

#### 2️⃣ 자격 증명 (로그인 정보)
- **마스터 사용자 이름**: `postgres` (기본값 유지)
- **마스터 암호**:
  - `암호 자동 생성` 체크 해제
  - 직접 입력: (예: `vmffpdlepdlxj1!`)
  - **⚠️ 주의**: 이 비밀번호는 `.env` 파일에 사용되므로 반드시 기억해두세요!

### Step 4: 인스턴스 구성

- **DB 인스턴스 클래스**: `db.t3.micro` (프리티어 가능)

### Step 5: 스토리지

- **스토리지 유형**: `범용 SSD (gp3)`
- **할당된 스토리지**: `20 GiB`
- **스토리지 자동 조정**: 활성화 (기본값)

### Step 6: 연결 (⚠️ 가장 중요!)

- **EC2 컴퓨팅 리소스에 연결**: `EC2 컴퓨터 리소스에 연결 안 함` (수동 설정 권장)
- **VPC**: EC2가 있는 VPC 선택 (목록에 `my-vpc` 등이 있으면 선택)
- **퍼블릭 액세스**: **`예`**
  - **이유**: 로컬 PC(내 컴퓨터)에서 DB 툴(DBeaver, pgAdmin)로 접속하여 확인하기 위함입니다.
- **VPC 보안 그룹(방화벽)**: `새로 생성`
  - **새 VPC 보안 그룹 이름**: `skn21-rds-sg`

### Step 7: 추가 구성

- **초기 데이터베이스 이름**: `postgres` 또는 `skn21_db`
  - **주의**: 이 항목을 비워두면 DB가 생성되지 않아 접속 후 직접 생성해야 합니다. **`postgres`라고 적는 것을 추천합니다.**

### Step 8: 생성 완료

- 하단 **"데이터베이스 생성"** 버튼 클릭.
- 생성되는 데 약 5~10분 정도 소요됩니다.
- 상태가 `사용 가능(Available)`이 될 때까지 기다립니다.

---

## 보안 그룹 설정 (중요)

데이터베이스가 생성되는 동안 보안 그룹을 설정합니다.

### Step 1: 보안 그룹 찾기

1. 생성된 RDS 데이터베이스(`skn21-django-db`) 클릭.
2. **"연결 및 보안"** 탭의 **"VPC 보안 그룹"** 아래 링크(`skn21-rds-sg`) 클릭.
3. 하단 **"인바운드 규칙"** 탭 -> **"인바운드 규칙 편집"** 클릭.

### Step 2: 규칙 추가

"규칙 추가" 버튼을 눌러 아래 두 가지 중 하나를 선택하여 설정하세요.

#### 옵션 A: 모든 곳에서 접속 허용 (편리함, 보안 주의 ⚠️)
팀원들의 IP가 계속 바뀌거나 카페 등에서 작업한다면 이 설정이 편합니다.

| 유형       | 프로토콜 | 포트 범위 | 소스          | 설명                         |
| ---------- | -------- | --------- | ------------- | ---------------------------- |
| PostgreSQL | TCP      | 5432      | **0.0.0.0/0** | 모든 IP 허용 (Anywhere-IPv4) |

> [!WARNING]
> 비밀번호가 노출되면 전 세계 어디서든 DB에 접속할 수 있습니다. 비밀번호를 **아주 강력하게 설정**해야 합니다.

#### 옵션 B: 특정 IP 및 EC2만 허용 (안전함 ✅)
보안이 중요하다면 이 방법을 사용하세요.

| 유형       | 프로토콜 | 포트 범위 | 소스                         | 설명                                 |
| ---------- | -------- | --------- | ---------------------------- | ------------------------------------ |
| PostgreSQL | TCP      | 5432      | **내 IP**                    | 현재 내 컴퓨터 접속용                |
| PostgreSQL | TCP      | 5432      | **사용자 지정** (`sg-xxxxx`) | EC2 보안 그룹 ID (`skn21-django-sg`) |

---

## 로컬에서 접속 테스트

DB 툴(DBeaver, pgAdmin, Datagrip 등)을 사용하여 접속을 테스트합니다.

1. **Host**: RDS 엔드포인트
   - RDS 콘솔 -> 데이터베이스 -> `skn21-django-db` -> `연결 및 보안` 탭 -> **엔드포인트** 복사
2. **Port**: `5432`
3. **Database**: `postgres` (초기 데이터베이스 이름)
4. **Username**: `postgres`
5. **Password**: (설정한 비밀번호)
6. **Test Connection (연결 테스트)** 클릭 -> 성공 시 확인.

---

## Django 프로젝트 연결

배포 서버(EC2) 또는 로컬의 `.env` 파일을 수정합니다.

```ini
# .env 파일

# ... 기존 설정 ...

# Database
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=설정한비밀번호
DB_HOST=skn21-django-db.xxxx.ap-northeast-2.rds.amazonaws.com
DB_PORT=5432
```

---

## 트러블슈팅

### ❌ 접속 실패 (Timeout)

- **원인 1**: 보안 그룹 설정 문제.
  - 해결: 보안 그룹 인바운드 규칙이 `0.0.0.0/0` (모두 허용)이거나, 현재 내 IP가 포함되어 있는지 확인하세요.
- **원인 2**: 퍼블릭 액세스가 **'아니요'**로 설정됨.
  - 해결: RDS 수정 -> 연결 -> 퍼블릭 액세스 '예'로 변경 -> '즉시 적용'.

### ❌ `FATAL: database "xxxxx" does not exist`

- **원인**: 초기 데이터베이스 이름을 설정하지 않음.
- **해결**:
  1. DBeaver 로컬 접속 시 Database에 `postgres` 입력하여 접속.
  2. SQL 편집기 열기.
  3. `CREATE DATABASE "원하는이름";` 실행.
