version: '3.8'

services:
  # Qdrant 벡터 데이터베이스
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant_local
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_storage:/qdrant/storage
    environment:
      - QDRANT__SERVICE__HTTP_PORT=6333
    restart: unless-stopped
    networks:
      - app_network

  # Django 개발 서버 (Hot-reload 지원)
  django:
    build:
      context: ../
      dockerfile: deploy/Dockerfile
    container_name: django_local
    ports:
      - "8000:8000"
    volumes:
      # 전체 소스 코드 마운트 (Hot-reload용)
      - ../:/app
    env_file:
      - ../.env.local
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - DJANGO_DEBUG=True
    depends_on:
      - qdrant
    restart: unless-stopped
    networks:
      - app_network
    # 개발 서버 실행 (Gunicorn 대신 runserver)
    command: python django_app/manage.py runserver 0.0.0.0:8000

volumes:
  qdrant_storage:


networks:
  app_network:
    driver: bridge
